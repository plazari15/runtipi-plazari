{
  "$schema": "https://schemas.runtipi.io/dynamic-compose.json",
  "schemaVersion": 2,
  "services": [
    {
      "name": "jupyter",
      "image": "${JUPYTER_IMAGE}",
      "isMain": true,
      "internalPort": 8888,
      "environment": {
        "JUPYTER_ENABLE_LAB": "${JUPYTER_INTERFACE}",
        "JUPYTER_TOKEN": "${JUPYTER_TOKEN}",
        "GRANT_SUDO": "yes",
        "CHOWN_HOME": "yes",
        "CHOWN_HOME_OPTS": "-R",
        "LANG": "${JUPYTER_LANG}.UTF-8",
        "LC_ALL": "${JUPYTER_LANG}.UTF-8"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/work",
          "containerPath": "/home/jovyan/work"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/notebooks",
          "containerPath": "/home/jovyan/notebooks"
        }
      ],
      "user": "root",
      "command": [
        "bash", "-c",
        "set -e && export DEBIAN_FRONTEND=noninteractive && apt-get update -qq && apt-get install -y -qq locales sudo && locale-gen ${JUPYTER_LANG}.UTF-8 2>/dev/null || locale-gen en_US.UTF-8 && pip install --quiet --no-cache-dir jupyterlab-language-pack-pt-BR jupyterlab-language-pack-es-ES jupyterlab-language-pack-fr-FR jupyterlab-language-pack-de-DE jupyterlab-language-pack-zh-CN jupyterlab-language-pack-ja-JP jupyterlab-language-pack-ko-KR jupyterlab-language-pack-ru-RU jupyterlab-language-pack-it-IT 2>/dev/null || echo 'Language packs installation completed with some warnings' && echo 'jovyan ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers && chown -R jovyan:users /home/jovyan && if [ \"${JUPYTER_AUTH_MODE}\" = \"none\" ]; then start-notebook.sh --NotebookApp.token='' --NotebookApp.password='' --NotebookApp.allow_root=True --NotebookApp.ip='0.0.0.0'; else start-notebook.sh --NotebookApp.token='${JUPYTER_TOKEN}' --NotebookApp.password='' --NotebookApp.allow_root=True --NotebookApp.ip='0.0.0.0'; fi"
      ]
    }
  ]
}
